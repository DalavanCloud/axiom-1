#!/usr/bin/python

# Benchmark of batch Item deletion.  Accepts no parameters.  Reports one
# statistic, the number of milliseconds it takes to batch delete an Item.

import sys

from axiom.store import Store
from axiom.attributes import integer
from axiom._bench import bench

import benchlib


def benchmark(numItems):
    SomeItem = benchlib.itemTypeWithSomeAttributes([integer])

    store = Store()
    innerCounter = range(numItems)

    def _create():
        benchlib.createSomeItems(store, SomeItem, {}, innerCounter)

    def _delete():
        store.query(SomeItem).deleteFromStore()

    bench(
        lambda: store.transact(_delete),
        prepare=lambda: store.transact(_create),
        loops=1,
        extraFactor=numItems)


def main(argv):
    if len(argv) != 2:
        raise SystemExit("Usage: %s <number of items>" % (argv[0],))
    benchmark(int(argv[1]))


if __name__ == '__main__':
    main(sys.argv)
