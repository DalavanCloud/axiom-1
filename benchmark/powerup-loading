#!/usr/bin/python

# Benchmark of Axiom powerup loading. Accepts no parameters. Reports one
# statistic, the number of milliseconds it takes to query for powerups after they
# have already been queried for once.


import sys

from zope.interface import Interface

from axiom.store import Store
from axiom.attributes import integer
from axiom._bench import bench

import benchlib


class IPowerup(Interface):
    """
    Empty interface to use for powerups.
    """


def benchmark(numLoops):
    SomeItem = benchlib.itemTypeWithSomeAttributes([integer])
    store = Store()
    items = []
    for i in range(10):
        item = SomeItem(store=store)
        store.powerUp(item, IPowerup)
        items.append(item)

    def _getPowerups(counter):
        list(store.powerupsFor(IPowerup))

    bench(lambda: _getPowerups, loops=numLoops)


def main(argv):
    if len(argv) != 2:
        raise SystemExit("Usage: %s <number of loops>" % (sys.argv[0],))
    benchmark(int(sys.argv[1]))


if __name__ == '__main__':
    main(sys.argv)
